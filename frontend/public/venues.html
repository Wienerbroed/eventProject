<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Venues</title>
    <style>
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .error-message {
            color: red;
            font-size: 14px;
        }
    </style>
</head>
<body>

<h1>Venues</h1>

<div id="venueContainer"></div>

<!-- Trigger/Open The Modal -->
<button id="addVenueBtn">Add Venue</button>

<!-- The Modal for Adding Venue -->
<div id="addVenueModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <!-- Registration Form -->
        <form id="addVenueForm">
            <h2>Add Venue</h2>
            <label for="venueNavn">Venue Name:</label>
            <input type="text" id="venueNavn" name="venueNavn" required>

            <label for="venueAdresse">Address:</label>
            <input type="text" id="venueAdresse" name="venueAdresse" required>

            <button type="submit">Add</button>
            <p id="addVenueError" class="error-message"></p>
        </form>
    </div>
</div>

<!-- The Modal for Viewing Venue Details -->
<div id="viewVenueModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="venueName"></h2>
        <p id="venueAddress"></p>
    </div>
</div>

<script>
    // Get the modals
    var addVenueModal = document.getElementById("addVenueModal");
    var viewVenueModal = document.getElementById("viewVenueModal");

    // Get the buttons that open the modals
    var addBtn = document.getElementById("addVenueBtn");

    // Get the <span> elements that close the modals
    var addSpan = addVenueModal.getElementsByClassName("close")[0];
    var viewSpan = viewVenueModal.getElementsByClassName("close")[0];

    // When the user clicks the button, open the add venue modal
    addBtn.onclick = function() {
        addVenueModal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modals
    addSpan.onclick = function() {
        addVenueModal.style.display = "none";
    }
    viewSpan.onclick = function() {
        viewVenueModal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modals, close them
    window.onclick = function(event) {
        if (event.target == addVenueModal) {
            addVenueModal.style.display = "none";
        }
        if (event.target == viewVenueModal) {
            viewVenueModal.style.display = "none";
        }
    }

    // Fetch venues and display them
    async function fetchVenues() {
        try {
            const response = await fetch('http://localhost:3000/api/venues');
            if (!response.ok) {
                throw new Error('Failed to fetch venues');
            }
            const venues = await response.json();
            displayVenues(venues);
        } catch (error) {
            console.error('Error:', error);
        }
    }

    function displayVenues(venues) {
        const venueContainer = document.getElementById('venueContainer');
        venueContainer.innerHTML = '';

        venues.forEach(venue => {
            const venueElement = document.createElement('div');
            venueElement.classList.add('venue');
            venueElement.innerHTML = `
                <h2>${venue.venueName}</h2>
                <p><strong>Address:</strong> ${venue.venueAddress}</p>
                <button class="view-btn" onclick="viewVenueDetails('${venue.venueName}', '${venue.venueAddress}')">View Details</button>
            `;
            venueContainer.appendChild(venueElement);
        });
    }

    function viewVenueDetails(name, address) {
        document.getElementById('venueName').innerText = name;
        document.getElementById('venueAddress').innerText = address;
        viewVenueModal.style.display = "block";
    }

    // Handle add venue form submission
    const addVenueForm = document.getElementById('addVenueForm');
    addVenueForm.addEventListener('submit', async (event) => {
        event.preventDefault(); // Prevent the default form submission

        const venueName = document.getElementById('venueNavn').value;
        const venueAddress = document.getElementById('venueAdresse').value;

        try {
            const response = await fetch('http://localhost:3000/api/venues/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    venueName: venueName,
                    venueAddress: venueAddress,
                }),
            });

            if (!response.ok) {
                throw new Error('Failed to add venue');
            }

            const result = await response.json();
            console.log('Venue added:', result);

            // Close the modal
            addVenueModal.style.display = 'none';

            // Clear the form
            addVenueForm.reset();

            // Refresh the venue list
            fetchVenues();
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('addVenueError').innerText = 'Failed to add venue. Please try again.';
        }
    });

    // Initial fetch of venues
    fetchVenues();
</script>

</body>
</html>
