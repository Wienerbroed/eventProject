<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add Event</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
  <h1>Add Event</h1>
  <button class="event-btn" onclick="window.location.href='event.html'">Go to Event</button>
  <button class="venue-btn" onclick="window.location.href='venues.html'">Go to Venues</button>
  <button class="calender-btn" onclick="window.location.href='eventCalender.html'">Go to Calendar</button>
</header>

<form id="addEventForm">
  <label for="title">Event Title:</label>
  <input type="text" id="title" name="title" required><br><br>

  <label for="eventCreator">Event Creator:</label>
  <input type="text" id="eventCreator" name="eventCreator" required><br><br>

  <label for="eventResponsible">Responsible Person:</label>
  <input type="text" id="eventResponsible" name="eventResponsible" required><br><br>

  <label for="eventControl">Control:</label>
  <input type="text" id="eventControl" name="eventControl" required><br><br>

  <label for="eventType">Event Type:</label>
  <input type="text" id="eventType" name="eventType" required><br><br>

  <label for="description">Description:</label>
  <textarea id="description" name="description" required></textarea><br><br>

  <label for="maxParticipants">Max Participants:</label>
  <input type="number" id="maxParticipants" name="maxParticipants" min="1" required><br><br>

  <label for="maxAudience">Max Audience:</label>
  <input type="number" id="maxAudience" name="maxAudience" min="1" required><br><br>

  <label for="conguideDk">Guide (DK):</label>
  <textarea id="conguideDk" name="conguideDk" required></textarea><br><br>

  <label for="conguideEn">Guide (EN):</label>
  <textarea id="conguideEn" name="conguideEn" required></textarea><br><br>

    <label>Warnings:</label><br>
    <input type="checkbox" id="wheelchair" name="warnings" value="wheelchair">
    <label for="wheelchair">Wheelchair Accessible</label><br>
    <input type="checkbox" id="strobelights" name="warnings" value="strobelights">
    <label for="strobelights">Strobelights</label><br>
    <input type="checkbox" id="loudNoises" name="warnings" value="loud noises">
    <label for="loudNoises">Loud Noises</label><br><br>

  <label for="eventRoomSelect">Event Room:</label>
  <select id="eventRoomSelect" name="eventRoomSelect" required>
    <!-- Event rooms will be dynamically populated here -->
  </select>

  <button type="submit">Add Event</button>
</form>

<script>
  // Function to populate event rooms dynamically
  async function populateEventRoomDropdown() {
    try {
      const response = await fetch('http://localhost:3000/api/eventrooms'); // Updated API endpoint for Event Rooms
      if (!response.ok) throw new Error('Failed to fetch event rooms');

      const eventRooms = await response.json();
      const eventRoomSelect = document.getElementById('eventRoomSelect');

      eventRooms.forEach(eventRoom => {
        const option = document.createElement('option');
        option.value = eventRoom.eventRoomId; // Use eventRoomId as the value
        option.textContent = eventRoom.eventRoomName; // Display eventRoomName
        eventRoomSelect.appendChild(option);
      });
    } catch (error) {
      console.error('Error fetching event rooms:', error);
    }
  }

  // Logout function
  async function logout() {
    try {
      const response = await fetch('http://localhost:3000/api/logout');
      if (response.ok) {
        window.location.href = 'loginAndRegisterPage.html';
      } else {
        alert('Failed to log out.');
      }
    } catch (error) {
      console.error('Error:', error);
      alert('An error occurred.');
    }
  }

  // Call the function on page load
  document.addEventListener('DOMContentLoaded', populateEventRoomDropdown);

  // Form submission logic
  document.getElementById('addEventForm').addEventListener('submit', async function(event) {
    event.preventDefault();

    const warnings = Array.from(document.querySelectorAll('input[name="warnings"]:checked'))
                          .map(checkbox => checkbox.value)
                          .join(',');

    const eventData = {
      title: document.getElementById('title').value,
      eventCreator: document.getElementById('eventCreator').value,
      eventResponsible: document.getElementById('eventResponsible').value,
      eventControl: document.getElementById('eventControl').value,
      eventType: document.getElementById('eventType').value,
      description: document.getElementById('description').value,
      maxParticipants: parseInt(document.getElementById('maxParticipants').value),
      maxAudience: parseInt(document.getElementById('maxAudience').value),
      conguideDk: document.getElementById('conguideDk').value,
      conguideEn: document.getElementById('conguideEn').value,
      warnings: document.getElementById('warnings').value, // Warnings field
      eventRoomId: document.getElementById('eventRoomSelect').value // Correct ID for Event Room
    };

    try {
      const response = await fetch('http://localhost:3000/api/events/add', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(eventData)
      });

      if (response.ok) {
        alert('Event added successfully!');
        window.location.href = 'event.html'; // Redirect to events page
      } else {
        alert('Failed to add event.');
      }
    } catch (error) {
      console.error('Error:', error);
      alert('An error occurred.');
    }
  });
</script>
</body>
</html>
